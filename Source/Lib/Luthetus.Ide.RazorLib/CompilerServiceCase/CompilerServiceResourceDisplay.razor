@using Luthetus.Common.RazorLib.Dimensions;
@using Luthetus.Common.RazorLib.FileSystem.Classes.FilePath;
@using Luthetus.CompilerServices.Lang.DotNetSolution.CompilerServiceCase;

@{
    var localCompilerServiceResource = CompilerServiceResource;

    var circleRadiusInPixelsCssValue = CompilerServiceDisplayDimensions.CircleRadiusInPixels.ToCssValue();

    var xCenterInPixelsCssValue = GetXCenterInPixels().ToCssValue();
    var yCenterInPixelsCssValue = GetYCenterInPixels().ToCssValue();

    var svgFontSizeInPixelsCssValue = CompilerServiceDisplayDimensions.SvgFontSizeInPixels.ToCssValue();

    var fontSizeStyleAttribute = $"font-size: {svgFontSizeInPixelsCssValue}px;";
}

<g class="luth_ide_compiler-service-resource">
    <circle stroke="darkgray" stroke-width="1px"
            fill="@GetFill(localCompilerServiceResource)"
            cx="@xCenterInPixelsCssValue" cy="@yCenterInPixelsCssValue" r="@circleRadiusInPixelsCssValue" />

    <text text-anchor="middle" dominant-baseline="middle"
          x="@xCenterInPixelsCssValue" y="@yCenterInPixelsCssValue"
          style="@fontSizeStyleAttribute">
        
        @{
            var absoluteFilePath = new AbsoluteFilePath(
                localCompilerServiceResource.ResourceUri.Value,
                false,
                EnvironmentProvider);
        }

        @absoluteFilePath.FilenameWithExtension
    </text>
</g>

@if (localCompilerServiceResource is DotNetSolutionResource dotNetSolutionResource &&
     dotNetSolutionResource.DotNetSolution is not null)
{
    var dotNetProjects = dotNetSolutionResource.DotNetSolution.DotNetProjects;

    for (var temporaryIndex = 0; temporaryIndex < dotNetProjects.Count; temporaryIndex++)
    {
        var index = temporaryIndex;
        var dotNetProject = dotNetProjects[index];

        var cSharpProjectResource = CSharpProjectCompilerService.CompilerServiceResources
            .SingleOrDefault(csr => 
                csr.ResourceUri.Value == dotNetProject.AbsoluteFilePath.GetAbsoluteFilePathString());

        if (cSharpProjectResource is not null)
        {
            <CompilerServiceResourceDisplay CompilerServiceResource="cSharpProjectResource"
                                            IndexAmongSiblings="index"
                                            Depth="Depth + 1"
                                            CountOfSiblingsAndSelf="@dotNetProjects.Count" />
        }
    }
}