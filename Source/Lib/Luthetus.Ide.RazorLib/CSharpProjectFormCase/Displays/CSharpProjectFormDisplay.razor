@using Luthetus.Ide.RazorLib.CSharpProjectFormCase.Viewables;
@using Luthetus.Ide.RazorLib.TerminalCase.Displays
@using Luthetus.Ide.RazorLib.TerminalCase.Models;
@using Luthetus.Ide.RazorLib.WebsiteProjectTemplatesCase
@using Luthetus.Ide.RazorLib.TerminalCase
@using Luthetus.Ide.RazorLib.CSharpProjectFormCase.Models
@using Luthetus.Ide.RazorLib.WebsiteProjectTemplatesCase.Models;

@inherits Fluxor.Blazor.Web.Components.FluxorComponent

<div class="luth_ide_c-sharp-project-form luth_ide_form @GetCssClassForActivePanelKind(_view.ActivePanelKind)">
    @if (DotNetSolutionModel is null)
    {
        <div>@nameof(DotNetSolutionModel) is null</div>
    }
    else
    {
        var view = new CSharpProjectFormScene(
            DotNetSolutionModel,
            EnvironmentProvider);

        <div class="luth_ide_c-sharp-project-form-top-inputs">
            <div class="luth_ide_form-group">
                <div class="luth_ide_form-label">
                    Project name:
                </div>

                <div class="luth_ide_form-value">
                    <input class="luth_ide_input luth_ide_input-text"
                           style="height: 2em;"
                           placeholder="Project name"
                    @bind="view.CSharpProjectNameValue"
                    @bind:event="oninput" />
                </div>
            </div>
        </div>

        <div class="luth_ide_c-sharp-project-form-middle-inputs">
            <div class="luth_ide_form-group luth_ide_disable-display-flex">
                <div class="luth_ide_form-label luth_ide_c-sharp-project-form-sticky">
                    <div class="luth_ide_c-sharp-project-form-sticky-left-side">
                        Project template:

                        <span class="luth_ide_c-sharp-project-form-tabs">
                            @foreach (var panelKind in Enum.GetValues<CSharpProjectFormPanelKind>())
                            {
                                <button class="luth_ide_panel-tab luth_button luth_tab @GetIsActiveCssClassString(panelKind)"
                                @onclick="() => view.ActivePanelKind = panelKind">

                                    @switch (panelKind)
                                    {
                                        case CSharpProjectFormPanelKind.Graphical:
                                            @: Graphically
                                            break;
                                        case CSharpProjectFormPanelKind.Manual:
                                            @: Manually
                                            break;
                                    }
                                </button>
                            }
                        </span>
                    </div>

                    <div class="luth_ide_c-sharp-project-form-sticky-right-side">
                        @if (view.ActivePanelKind == CSharpProjectFormPanelKind.Graphical)
                        {
                            <div class="luth_ide_graphical-project-template-search-container">
                                <input class="luth_ide_input luth_ide_input-text"
                                       type="text"
                                       placeholder="Search"
                                       autocapitalize="none"
                                       autocorrect="off"
                                       autocomplete="off"
                                       spellcheck="false"
                                @bind="view.SearchInput"
                                @bind:event="oninput" />
                            </div>
                        }
                    </div>
                </div>

                <div class="luth_ide_form-value">
                    <div class="luth_ide_c-sharp-project-form-panel">
                        @if (view.ActivePanelKind == CSharpProjectFormPanelKind.Graphical)
                        {
                            <div class="luth_ide_graphical-project-template-inputs">
                                @if (view.IsReadingProjectTemplates)
                                {
                                    <div>
                                        Reading project templates
                                        <IconLoading />
                                    </div>
                                }
                                else
                                {
                                    <div class="luth_ide_graphical-project-template-container">
                                        @{
                                            List<ProjectTemplate> filteredProjectTemplateContainer = view.ProjectTemplateContainer;

                                            var localSearchInput = view.SearchInput;

                                            if (!string.IsNullOrWhiteSpace(localSearchInput))
                                            {
                                                filteredProjectTemplateContainer = view.ProjectTemplateContainer.Where(pt =>
                                                pt.TemplateName!.Contains(localSearchInput, StringComparison.InvariantCultureIgnoreCase) ||
                                                pt.ShortName!.Contains(localSearchInput, StringComparison.InvariantCultureIgnoreCase) ||
                                                pt.Language!.Contains(localSearchInput, StringComparison.InvariantCultureIgnoreCase) ||
                                                pt.Tags!.Contains(localSearchInput, StringComparison.InvariantCultureIgnoreCase))
                                                .ToList();
                                            }

                                            foreach (var projectTemplate in filteredProjectTemplateContainer)
                                            {
                                                <ProjectTemplateDisplay ProjectTemplate="projectTemplate"
                                                                        ShortNameOfSelectedProjectTemplate="@view.ProjectTemplateShortNameValue"
                                                                        OnProjectTemplateSelectedEventCallback="pt => view.ProjectTemplateShortNameValue = pt.ShortName!" />
                                            }
                                        }
                                    </div>
                                }
                            </div>
                        }
                        else if (view.ActivePanelKind == CSharpProjectFormPanelKind.Manual)
                        {
                            <div class="luth_ide_manual-project-template-inputs">
                                <div class="luth_ide_form-group">
                                    <div class="luth_ide_form-label">
                                        Template name:
                                    </div>

                                    <div class="luth_ide_form-value">
                                        <input class="luth_ide_input luth_ide_input-text"
                                               style="height: 2em;"
                                               placeholder="Template name"
                                        @bind="view.ProjectTemplateShortNameValue"
                                        @bind:event="oninput" />
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="luth_ide_c-sharp-project-form-bottom-inputs">
            <div class="luth_ide_form-group">
                <div class="luth_ide_form-label">
                    Directory:
                </div>

                <div class="luth_ide_form-value"
                     style="display: flex;">

                    <input class="luth_ide_input luth_ide_input-text"
                           style="height: 2em;"
                           placeholder="Parent directory"
                    @bind="view.ParentDirectoryNameValue"
                    @bind:event="oninput" />

                    <button class="luth_button"
                    @onclick='async () => RequestInputFileForParentDirectory("Directory for new C# Project")'>
                        <IconFolder />
                    </button>
                </div>
            </div>

            <div class="luth_ide_form-group">
                <div class="luth_ide_form-label">
                    Optional parameters:
                </div>

                <div class="luth_ide_form-value">
                    <input class="luth_ide_input luth_ide_input-text"
                           style="height: 2em;"
                           placeholder="Optional parameters"
                    @bind="view.OptionalParametersValue"
                    @bind:event="oninput" />
                </div>
            </div>
        </div>

        <div class="luth_ide_form-output-container">
            <div class="luth_ide_form-output-entry">
                <span class="luth_ide_form-output-entry-label">
                    Project&nbsp;Name:
                </span>
                <span class="luth_ide_form-output-entry-value">
                    <em class="luth_em">@view.CSharpProjectNameDisplay</em>
                    .csproj
                </span>
            </div>

            <div class="luth_ide_form-output-entry">
                <span class="luth_ide_form-output-entry-label">
                    Template&nbsp;Name:
                </span>
                <span class="luth_ide_form-output-entry-value">
                    <em class="luth_em">@view.ProjectTemplateShortNameDisplay</em>
                </span>
            </div>

            <div class="luth_ide_form-output-entry">
                <span class="luth_ide_form-output-entry-label">
                    Optional&nbsp;Parameters:
                </span>
                <span class="luth_ide_form-output-entry-value">
                    <em class="luth_em">@view.OptionalParametersDisplay</em>
                </span>
            </div>

            <div class="luth_ide_form-output-entry">
                <span class="luth_ide_form-output-entry-label">
                    Directory&nbsp;Absolute&nbsp;File&nbsp;Path:
                </span>
                <span class="luth_ide_form-output-entry-value">
                    <em class="luth_em">@view.ParentDirectoryNameDisplay</em>
                </span>
            </div>
        </div>

        <div class="luth_ide_c-sharp-project-form-submit-section">
            <div class="luth_ide_c-sharp-project-form-command-section">
                Command:
                <div>
                    <em class="luth_em">
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        @view.FormattedNewCSharpProjectCommand.Value
                        &nbsp;\
                    </em>

                    <br />

                    <em class="luth_em">
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        &nbsp;&nbsp;&nbsp;&nbsp;
                        @view.FormattedAddExistingProjectToSolutionCommand.Value
                    </em>
                </div>
            </div>

            <button class="luth_button"
            @onclick="StartNewCSharpProjectCommandOnClick">
                Run
            </button>

            <TerminalOutputDisplay TerminalSessionKey="TerminalSessionFacts.GENERAL_TERMINAL_SESSION_KEY"
                                   TerminalCommandKey="view.NewCSharpProjectTerminalCommandKey" />
        </div>
    }
</div>