@using Luthetus.Common.RazorLib.Contexts.Displays
@using Luthetus.Common.RazorLib.Contexts.Models
@using Luthetus.Ide.RazorLib.Terminals.Displays
@using Luthetus.Ide.RazorLib.Terminals.Models
@using System.Collections.Immutable
@using Luthetus.Common.RazorLib.Dropdowns.Displays
@using Luthetus.Common.RazorLib.Dropdowns.Models;
@using Luthetus.Common.RazorLib.TreeViews.Displays
@using Luthetus.Common.RazorLib.TreeViews.Models;

<ContextBoundary ContextRecord="ContextFacts.TestExplorerContext"
                 ClassCssString="luth_ide_test-explorer"
                 StyleCssString="height: 100%; width: 100%;">

    <div class="luth_ide_section-title">
        Test Explorer
    </div>

    <div class="luth_ide_section-body"
         style="width: 100%;">

		@{ 
			var dotNetSolutionState = DotNetSolutionStateWrap.Value;
			var dotNetSolutionModel = dotNetSolutionState.DotNetSolutionModel;
		}
  
		<hr/>
		
		@if (dotNetSolutionModel is null)
		{
			@: No solution has been chosen yet.
		}
		else
		{
			<div>@dotNetSolutionModel.AbsolutePath.Value</div>

			<CascadingValue Name="LuthetusTreeViewIconWidth" Value="AppOptionsStateWrap.Value.Options.IconSizeInPixels">
                <CascadingValue Name="LuthetusTreeViewIconHeight" Value="AppOptionsStateWrap.Value.Options.IconSizeInPixels">
                    <CascadingValue Name="OffsetPerDepthInPixels" Value="OffsetPerDepthInPixels">
                        <TreeViewContainerDisplay TreeViewStateKey="TreeViewTestExplorerKey"
                                                  CssStyleString="height: 100%;"
                                                  OnContextMenuFunc="OnTreeViewContextMenuFunc"
                                                  TreeViewKeyboardEventHandler="_treeViewKeyboardEventHandler"
                                                  TreeViewMouseEventHandler="_treeViewMouseEventHandler" />
                    </CascadingValue>
                </CascadingValue>
            </CascadingValue>
			
			<DropdownDisplay DropdownKey="TestExplorerContextMenu.ContextMenuEventDropdownKey"
                             DropdownPositionKind="DropdownPositionKind.Unset"
                             CssStyleString="@TestExplorerContextMenu.GetContextMenuCssStyleString(_mostRecentTreeViewCommandArgs)">

                <TestExplorerContextMenu TreeViewCommandArgs="_mostRecentTreeViewCommandArgs" />
            </DropdownDisplay>
		}
    </div>
</ContextBoundary>