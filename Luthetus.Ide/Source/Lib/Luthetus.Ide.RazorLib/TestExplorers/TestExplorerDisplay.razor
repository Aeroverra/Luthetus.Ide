@using Luthetus.Common.RazorLib.Contexts.Displays
@using Luthetus.Common.RazorLib.Contexts.Models
@using Luthetus.Ide.RazorLib.Terminals.Displays
@using Luthetus.Ide.RazorLib.Terminals.Models
@using System.Collections.Immutable

@inherits Fluxor.Blazor.Web.Components.FluxorComponent

<ContextBoundary ContextRecord="ContextFacts.TestExplorerContext"
                 ClassCssString="luth_ide_test-explorer"
                 StyleCssString="height: 100%; width: 100%;">

    <div class="luth_ide_section-title">
        Test Explorer
    </div>

    <div class="luth_ide_section-body"
         style="width: 100%;">
  
		<div>
			@{
				var generalTerminalSession = TerminalSessionsStateWrap.Value.TerminalSessionMap[
                	TerminalSessionFacts.GENERAL_TERMINAL_SESSION_KEY];
			}
			WorkingDirectoryAbsolutePathString:&nbsp;
			@(generalTerminalSession.WorkingDirectoryAbsolutePathString ?? "null")
		</div>

		<hr/>

		<div class="luth_ide_form-group">
	        <div class="luth_ide_form-label">
	            Directory:
	        </div>
	
	        <div class="luth_ide_form-value"
	             style="display: flex;">
	
	            <input class="luth_ide_input luth_ide_input-text"
	                   style="height: 2em;"
	                   placeholder="Directory for test discovery"
	                   @bind="_directoryNameForTestDiscovery"
	                   @bind:event="oninput"/>
	
	            <button class="luth_button"
	                    @onclick="RequestInputFileForTestDiscovery">
	                <IconFolder/>
	            </button>
	        </div>
    	</div>

		<hr/>      
        
		<button class="luth_button"
				@onclick="StartDotNetTestListTestsCommandOnClick">
			DOTNET_TEST_LIST_TESTS_COMMAND
		</button>

		<hr/>

		@{
			var localDotNetTestListTestsCommandOutput = _dotNetTestListTestsCommandOutput
				?.ToImmutableArray() ?? Array.Empty<string>().ToImmutableArray();
			
			if (localDotNetTestListTestsCommandOutput.Length == 0)
			{
				<div>NO OUTPUT</div>
			}

			foreach (var output in localDotNetTestListTestsCommandOutput)
			{
				<div style="margin-bottom: 15px;">
					<button class="luth_button"
							style="display: inline;"
							@onclick="() => RunTestByFullyQualifiedName(output)">
						Run:&nbsp;
					</button>

					@output
				</div>
			}
		}

		<hr/>
		
		<div style="height: 150px;">
			<div>Terminal Output:</div>
			<TerminalOutputDisplay TerminalSessionKey="TerminalSessionFacts.GENERAL_TERMINAL_SESSION_KEY" 
                                   TerminalCommandKey="DotNetTestListTestsTerminalCommandKey" />
		</div>
    </div>
</ContextBoundary>